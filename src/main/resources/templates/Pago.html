<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Pago - HanaServizi</title>
    <link rel="icon" type="image" th:href="@{/img/icon.png}"/>
    <link rel="stylesheet" th:href="@{/CSS/pagos.css}">
    <script src="https://js.stripe.com/v3/"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
<!-- HEADER -->
<header class="header">
    <div class="header_container">
        <div class="logo">
            <img th:src="@{/img/icon.png}" alt="Logo De HanaServizi">
            <h2 class="name-project"> HanaServizi</h2>
        </div>
        <nav class="nav-menu">

            <!--not logged-->
            <div th:unless="${nombreUsuario}" class="nav-not-logged">
                <a th:href="@{/productos/catalogo}" class="btn-catalog">Catalogo De Productos</a>
                <a th:href="@{/login}"><button class="btn6"><strong>Iniciar Sesión</strong></button></a>
                <a th:href="@{/usuarios/registro}"><button class="btn6"><strong>Registrarse</strong></button></a>
            </div>

            <!-- log in-->
            <div th:if="${nombreUsuario}" class="nav-logged">
                <div class="usuario-info">
                    <span class="nav-user">
            ¡Hola, <strong th:text="${nombreUsuario}">Usuario</strong>!
        </span>
                </div>
                <a th:if="${rolUsuario == 'ROLE_VENDEDOR'}" th:href="@{/vendedor/dashboard}" class="btn-icon">
                    <i class="fa-solid fa-user"></i>
                </a>

                <a th:if="${rolUsuario == 'ROLE_CLIENTE'}" th:href="@{/cliente/dashboard}" class="btn-icon">
                    <i class="fa-solid fa-user"></i>
                </a>

                <a th:if="${rolUsuario == 'ROLE_ADMIN'}" th:href="@{/admin/dashboard}" class="btn-icon">
                    <i class="fa-solid fa-user-shield"></i>
                </a>
                <a th:href="@{/productos/catalogo}" class="btn-catalog">Catalogo De Productos</a>

                <a th:href="@{/productos/notificaciones}" class="btn-icon" style="position:relative;">
                    <i class="fa-solid fa-bell"></i>
                    <span class="badge" th:if="${notificacionesNoLeidas != null and notificacionesNoLeidas.size() > 0}"
                          th:text="${notificacionesNoLeidas.size()}"
                          style="position:absolute; top:-6px; right:-6px; background:#2196f3; color:#fff; font-size:12px; border-radius:50%; padding:3px 6px;">
                    </span>
                </a>

                <a th:href="@{/carrito}" class="btn-icon">
                    <i class="fa-solid fa-cart-shopping"></i>
                </a>
            </div>

            <button id="toggle-dark-mode" class="modo-btn">
                <i class="fa-solid fa-moon"></i>
                <span class="modo-text">Modo Oscuro</span>
            </button>
        </nav>
    </div>
</header>

<!-- CONTENIDO PRINCIPAL -->
<div class="payment-container">

    <!-- FORMULARIO DE PAGO -->
    <div class="payment-form">
        <div class="checkout-steps">
            <span class="step">1. Carrito</span>
            <span class="step active">2. Pago</span>
            <span class="step">3. Confirmación</span>
        </div>

        <h2>Completar Pago</h2>
        <p>Selecciona el método de pago. Todas las transacciones son seguras.</p>

        <p><strong>Total a pagar:</strong>
            <span class="total-pagar">$<span th:text="${#numbers.formatDecimal(totalFinal,1,'COMMA',2,'POINT')}"></span> COP</span>
        </p>

        <label for="telefono">Teléfono</label>
        <input id="telefono" name="telefono" type="text" placeholder="Ej: 3001234567"
               class="input-text" th:value="${telefono}" required />

        <label for="direccion">Dirección</label>
        <input id="direccion" name="direccion" type="text" placeholder="Ej: Calle 10 #20-30"
               class="input-text" th:value="${direccion}" required />


        <hr style="margin: 20px 0;">

        <label for="metodo-pago">Método de Pago</label>
        <select id="metodo-pago" class="input-select">
            <option value="tarjeta">Tarjeta (Stripe)</option>
            <option value="nequi">Nequi</option>
            <option value="daviplata">Daviplata</option>
        </select>

        <form id="payment-form">

            <div id="tarjeta-form">
                <label for="cardholder-name">Nombre en la tarjeta</label>
                <input id="cardholder-name" type="text" placeholder="Nombre como aparece en la tarjeta" class="input-text" required/>
                <label for="card-element">Datos de la tarjeta</label>
                <div id="card-element"></div>
                <div id="card-errors" style="color:red;margin-top:8px;"></div>
            </div>

            <div id="nequi-form" style="display:none;">
                <label for="telefono-nequi">Número Nequi</label>
                <input id="telefono-nequi" type="text" placeholder="Ej: 3001234567" class="input-text"/>
            </div>

            <div id="daviplata-form" style="display:none;">
                <label for="telefono-daviplata">Número Daviplata</label>
                <input id="telefono-daviplata" type="text" placeholder="Ej: 3109876543" class="input-text"/>
            </div>

            <button id="pay-btn" class="btn btn-success">Pagar Ahora</button>
            <div id="payment-message"></div>
        </form>
    </div>

    <!-- RESUMEN DEL PEDIDO -->
    <aside class="payment-summary">
        <h2>Resumen del Pedido</h2>

        <!-- Lista de productos -->
        <div class="productos-resumen">
            <div th:each="item : ${carrito}" class="producto-item">
                <img th:src="@{'/uploads/' + ${item.imagen}}" class="producto-img"/>
                <div class="producto-detalle">
                    <p><strong th:text="${item.nombre}"></strong></p>
                    <p>Talla: <span th:text="${item.talla}"></span></p>
                    <p>Cantidad: <span th:text="${item.cantidad}"></span></p>
                    <p>Precio: $<span th:text="${#numbers.formatDecimal(item.precio,1,'COMMA',2,'POINT')}"></span></p>
                    <p>Subtotal: $<span th:text="${#numbers.formatDecimal(item.precio * item.cantidad,1,'COMMA',2,'POINT')}"></span></p>
                </div>
            </div>

        </div>

        <!-- Totales -->
        <hr/>
        <p><strong>Total artículos:</strong> $<span th:text="${#numbers.formatDecimal(subtotal,1,'COMMA',2,'POINT')}"></span></p>
        <p><strong>Descuento:</strong> -$<span th:text="${#numbers.formatDecimal(descuentoAplicado,1,'COMMA',2,'POINT')}"></span></p>
        <p><strong>Total final:</strong>
            <span class="total-pagar">
            $<span th:text="${#numbers.formatDecimal(totalFinal,1,'COMMA',2,'POINT')}"></span> COP
        </span>
        </p>

        <!-- Iconos de seguridad -->
        <div class="security-icons">
            <i class="fas fa-lock"></i> Pago seguro &nbsp; | &nbsp;
            <i class="fas fa-shield-alt"></i> Protección al comprador
        </div>
    </aside>

</div>


<footer>
    <div class="footer-col">
        <h4>Nuestras Redes</h4>
        <div class="links">
            <a href="#"><i class="fa-brands fa-facebook"></i></a>
            <a href="#"><i class="fa-brands fa-instagram"></i></a>
            <a href="#"><i class="fa-brands fa-tiktok"></i></a>
        </div>
    </div>
    <div class="footer-col">
        <h4> Acerca De Hana Servizi</h4>
        <ul>
            <li> <a href="#">Sobre Nosotros</a></li>
            <li> <a href="#">Nuestras Políticas</a></li>
            <li> <a href="#">Términos De Servicio</a></li>
            <li> <a href="#">Políticas De Privacidad</a></li>
            <li> <a href="#">Políticas De Reembolsos y Devoluciones</a></li>
        </ul>
    </div>
    <div class="footer-col">
        <h4> Contacto </h4>
        <ul class="info">
            <li>
                <span><i class="fa-solid fa-phone"></i></span><p>+57 123 4567 890</p>
            </li>
            <li>
                <span><i class="fa-solid fa-envelope"></i></span><p>hanaservizi@gmail.com</p>
            </li>
        </ul>
    </div>
    <div class="footer-col">
        <h4> Métodos De Pago</h4>
        <ul>
            <img th:src="@{/img/pay.png}" alt="">
            <img class="img3" th:src="@{/img/Nequi.webp}" alt="">
        </ul>
    </div>
</footer>
<div class="copyright">
    <p>©2024 HanaServizi. ALL Rights Reserved.</p>
</div>
<script th:src="@{/JS/cambioColor.js}" defer></script>

<!-- JS -->
<script th:inline="javascript">
    const stripePublicKey = /*[[${stripePublicKey}]]*/ 'pk_test_xxx';
    const totalFinal = /*[[${totalFinal}]]*/ 0;
    const usuarioId = /*[[${usuarioId}]]*/ 0;
</script>
<script th:src="@{/JS/scriptPagos.js}"></script>
</body>
</html>

<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrito de Compras - HanaServizi</title>
    <link rel="icon" type="image" th:href="@{/img/icon.png}">
    <link rel="stylesheet" th:href="@{/CSS/carrito.css}">
    <script th:src="@{/JS/carrito.js}" defer></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
</head>
<body>
<header class="header">
    <div class="header_container">
        <div class="bars">
            <div class="line"></div>
            <div class="line"></div>
            <div class="line"></div>
        </div>
        <div class="logo">
            <img th:src="@{/img/icon.png}" alt="Logo De HanaServizi" class="logo-img">
            <h2 class="name-project"> HanaServizi</h2>
        </div>

        <nav class="nav-menu">
            <a th:href="@{/productos/index}" class="active btn-icon"><strong>Inicio</strong></a>

            <!-- Botón usuario -->
            <a th:if="${nombreUsuario != null}"
               th:href="${rolUsuario == 'ROLE_VENDEDOR'} ? @{/vendedor/dashboard}
            : (${rolUsuario == 'ROLE_ADMIN'} ? @{/admin/dashboard}
            : @{/cliente/dashboard})"
               class="btn-icon">
                <i class="fa-solid fa-user"></i>
                <span th:text="${nombreUsuario}"></span>
            </a>


            <a href="#" class="btn-icon">
                <i class="fa-solid fa-bell"></i>
            </a>

            <a th:href="@{/carrito}" class="btn-icon btn-cart" th:if="${nombreUsuario != null}">
                <i class="fa-solid fa-cart-shopping"></i>
                <span th:text=" ${nombreUsuario} "></span>
            </a>


            <!-- Mostrar solo si NO está logueado -->
            <a th:if="${nombreUsuario == null}" th:href="@{/login}">
                <button class="btn6"><strong>Iniciar Sesión</strong></button>
            </a>
            <a th:if="${nombreUsuario == null}" th:href="@{/register}">
                <button class="btn6"><strong>Registrarse</strong></button>
            </a>

            <!-- Modo oscuro -->
            <button id="toggle-dark-mode" class="modo-btn">
                <i class="fa-solid fa-moon"></i>
                <span class="modo-text">Modo Oscuro</span>
            </button>
        </nav>
    </div>
</header>


<div class="cart-container">
    <div class="cart-items">

        <div class="checkout-steps">
            <span class="step active">1. Carrito</span>
            <span class="step">2. Pago</span>
            <span class="step">3. Confirmación</span>
        </div>

        <h2>Tu Carrito</h2>
        <ul>
            <li th:if="${carrito == null or #lists.isEmpty(carrito)}">
                <p>El carrito está vacío.</p>
            </li>

            <li class="cart-item" th:each="entry : ${carrito}">
                <!-- Imagen -->
                <div class="item-img">
                    <img th:src="@{'/uploads/' + ${entry.value.imagen}}" alt="Imagen producto">
                </div>

                <!-- Detalles -->
                <div class="item-details">
                    <strong th:text="${entry.value.nombre}"></strong>

                    <!-- Mostrar talla si existe -->
                    <p th:if="${entry.value.talla != null}">
                        Talla: <span th:text="${entry.value.talla}"></span>
                    </p>

                    <p>
                        Precio: $<span th:text="${#numbers.formatDecimal(entry.value.precio, 1, 'COMMA', 2, 'POINT')}"></span>
                    </p>

                    <div class="quantity-controls">
                        <form th:action="@{'/carrito/decrementar/' + ${entry.key}}" method="post" style="display:inline;">
                            <button type="submit" class="btn decrease">-</button>
                        </form>

                        <form th:action="@{'/carrito/actualizar/' + ${entry.key}}" method="post" style="display:inline;">
                            <input type="number"
                                   min="1"
                                   name="cantidad"
                                   th:value="${entry.value.cantidad}"
                                   style="width:50px; text-align:center; font-weight:bold;"
                                   onchange="this.form.submit()">
                        </form>

                        <form th:action="@{'/carrito/incrementar/' + ${entry.key}}" method="post" style="display:inline;">
                            <button type="submit" class="btn increase">+</button>
                        </form>
                    </div>

                    <p>
                        Total: $
                        <span class="total-product"
                              th:text="${#numbers.formatDecimal(entry.value.precio * entry.value.cantidad, 1, 'COMMA', 2, 'POINT')}"></span>
                    </p>

                    <form th:action="@{/carrito/eliminar/{id}(id=${entry.key})}" method="post">
                        <button type="submit" class="btn btn-danger">Eliminar</button>
                    </form>
                </div>
            </li>
        </ul>

        <a th:href="@{'/productos/index'}" class="btn">Volver a la tienda</a>
    </div>

    <div class="cart-summary">
        <h2>Resumen del Pedido</h2>
        <div class="totals">
            <p><strong>Total artículos:</strong> $<span th:text="${#numbers.formatDecimal(subtotal, 1, 'COMMA', 2, 'POINT')}"></span></p>
            <p><strong>Descuento:</strong> -$<span th:text="${#numbers.formatDecimal(descuentoAplicado, 1, 'COMMA', 2, 'POINT')}"></span></p>
            <p><strong>Total:</strong> $<span th:text="${#numbers.formatDecimal(totalFinal, 1, 'COMMA', 2, 'POINT')}"></span></p>
        </div>

        <span class="warning-text">Por favor consulte el monto de su pago real final.</span>
        <span class="warning-text">La disponibilidad y el precio de los artículos no están garantizados hasta que se finalice el pago.</span>
        <span class="warning-text">No se te cobrará hasta que revises este pedido en la página siguiente</span>

        <a th:href="@{/pago(total=${#numbers.formatInteger(totalFinal,0)})}" class="btn btn-success">Realizar Pedido</a>

        <div class="security-icons">
            <i class="fas fa-lock"></i> Pago seguro &nbsp; | &nbsp;
            <i class="fas fa-shield-alt"></i> Protección al comprador
        </div>

        <div class="payment-info">
            <h3>Opciones de pago seguro</h3>
            <p>HanaServizi se compromete a proteger su información de pago. Seguimos los estándares PCI DSS, utilizamos un cifrado sólido y realizamos revisiones periódicas del sistema para proteger tu privacidad.</p>

            <ul>
                <li>Métodos de pago verificados</li>
                <li>Certificación de seguridad activa</li>
            </ul>

            <h3>Privacidad segura</h3>
            <p>Proteger tu privacidad es muy importante para nosotros. Tu información se mantendrá segura y libre de riesgos.</p>

            <h3>Protección al comprador</h3>
            <ul>
                <li>Entrega garantizada</li>
                <li>$4.000 de crédito por retraso</li>
                <li>Reembolso por 15 días sin actualizaciones</li>
                <li>Devolución si el artículo está dañado</li>
                <li>Reembolso por 60 días sin entrega</li>
            </ul>
        </div>
    </div>
</div>
<footer>
    <div class="footer-col">
        <h4>Nuestras Redes</h4>
        <div class="links">
            <a href="#"><i class="fa-brands fa-facebook"></i></a>
            <a href="#"><i class="fa-brands fa-instagram"></i></a>
            <a href="#"><i class="fa-brands fa-tiktok"></i></a>
        </div>
    </div>
    <div class="footer-col">
        <h4> Acerca De Hana Servizi</h4>
        <ul>
            <li> <a href="#">Sobre Nosotros</a></li>
            <li> <a href="#">Nuestras Políticas</a></li>
            <li> <a href="#">Términos De Servicio</a></li>
            <li> <a href="#">Políticas De Privacidad</a></li>
            <li> <a href="#">Políticas De Reembolsos y Devoluciones</a></li>
        </ul>
    </div>
    <div class="footer-col">
        <h4> Contacto </h4>
        <ul class="info">
            <li>
                <span><i class="fa-solid fa-phone"></i></span><p>+57 123 4567 890</p>
            </li>
            <li>
                <span><i class="fa-solid fa-envelope"></i></span><p>hanaservizi@gmail.com</p>
            </li>
        </ul>
    </div>
    <div class="footer-col">
        <h4> Métodos De Pago</h4>
        <ul>
            <img th:src="@{/img/pay.png}" alt="">
            <img class="img3" th:src="@{/img/Nequi.webp}" alt="">
        </ul>
    </div>
</footer>
<div class="copyright">
    <p>©2024 HanaServizi. ALL Rights Reserved.</p>
</div>
<script th:src="@{/JS/cambioColor.js}" defer></script>

</body>
</html>
